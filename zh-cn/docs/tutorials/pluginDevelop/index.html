<!doctype html>
<html class="docs-version-current" lang="zh-cn" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">插件开发 | Eva.js</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://eva.js.org/zh-cn/docs/tutorials/pluginDevelop"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-cn"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="插件开发 | Eva.js"><meta data-react-helmet="true" name="description" content="一般通过脚本组件的方式就可以实现大部分逻辑，涉及引擎级别或者业务级别的通用能力，可以使用插件的形式进行开发，插件主要是由 Component 和 System 组成。"><meta data-react-helmet="true" property="og:description" content="一般通过脚本组件的方式就可以实现大部分逻辑，涉及引擎级别或者业务级别的通用能力，可以使用插件的形式进行开发，插件主要是由 Component 和 System 组成。"><link data-react-helmet="true" rel="shortcut icon" href="/zh-cn/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://eva.js.org/zh-cn/docs/tutorials/pluginDevelop"><link data-react-helmet="true" rel="alternate" href="https://eva.js.org/docs/tutorials/pluginDevelop" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://eva.js.org/zh-cn/docs/tutorials/pluginDevelop" hreflang="zh-cn"><link data-react-helmet="true" rel="alternate" href="https://eva.js.org/docs/tutorials/pluginDevelop" hreflang="x-default"><link rel="stylesheet" href="/zh-cn/assets/css/styles.3c723cb4.css">
<link rel="preload" href="/zh-cn/assets/js/runtime~main.ae83285c.js" as="script">
<link rel="preload" href="/zh-cn/assets/js/main.2e9ad81b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-cn/"><div class="navbar__logo"><img src="/zh-cn/img/logo.png" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/zh-cn/img/logo.png" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Eva.js</b></a><a class="navbar__item navbar__link navbar__link--active" href="/zh-cn/docs/tutorials/quickstart">教程</a><a class="navbar__item navbar__link" href="/zh-cn/docs/api/index">API</a><a href="https://eva.js.org/playground" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Demos<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.yuque.com/eva/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/eva-engine/eva.js/issues/140" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>常见问题<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/eva-engine/eva.js" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">English</a><ul class="dropdown__menu"><li><a href="https://eva.js.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>English<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://eva-engine.github.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>中文（中国）<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-cn/docs/tutorials/quickstart">快速开始</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/eva-engine/eva.js/issues/140" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Q&amp;A<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">Basic</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/resourceManagement">资源管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/game">游戏 Game</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/gameObject">游戏对象 GameObject</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/transformComponent">Transform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/compressedTexture">纹理压缩格式的使用</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">Graphics</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/prepareRender">准备</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/imageComponent">图片 Image</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/textComponent">文本 Text</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/graphicsComponent">图形 Graphics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/spriteComponent">精灵图 Sprite</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/maskComponent">遮罩 Mask</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/ninePatchComponent">九宫格 NinePatch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/tilingSpriteComponent">平铺精灵 TilingSprite</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/orderAndTransparent">遮挡排序与透明度</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">Animation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/transitionAnimation">过渡动画</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/spriteAnimation">帧动画</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/spineAnimation">Spine 骨骼动画</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/dragonboneAnimation">Dragonbones 龙骨动画</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/lottieAnimation">Lottie 动画</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/interactionEvent">交互事件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/customComponent">脚本组件</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Plugin</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/sound">Sound 音频系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/matterJS">MatterJS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/a11yPlugin">A11y 无障碍插件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/evaxPlugin">数据管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-cn/docs/tutorials/performancePlugin">性能监控</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-cn/docs/tutorials/pluginDevelop">插件开发</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="插件开发">插件开发</h1><p>一般通过脚本组件的方式就可以实现大部分逻辑，涉及引擎级别或者业务级别的通用能力，可以使用插件的形式进行开发，插件主要是由 Component 和 System 组成。</p><p>Eva.js 的渲染是基于 <a href="http://pixijs.io/">PixiJS</a> 的，一般 Img/Sprite/Spine 等插件实际上是创建了 Pixi 的渲染对象，像 Stats/EvaX/Transition 等插件不依赖 Pixi。不管是哪种插件都是输出 Component 和 System 给引擎使用，但是开发方案有一些不同，接下来我会先讲解最简单的插件开发方法。</p><p>我们提供了一个<a href="https://github.com/eva-engine/plugin-template">插件模板</a>，可以点击 <code>Use this Template</code> 直接使用模版进行开发，里面带了必要的脚手架。</p><h2 id="基础">基础</h2><h3 id="开发">开发</h3><p>读到这里，相信大家已经对 Eva.js 有所了解并且知道如何在项目中使用了，下面是一个插件的简单的使用方法。</p><pre><code class="language-js">import { Demo, DemoSystem } from &#x27;./tutorials/lib&#x27;
const game = new Game({
  systems: [new DemoSystem()]
})
const go = new GameObject()
go.addComponent(new Demo())
game.scene.addChild(go)
</code></pre><p>我们可以看到，插件是由 Component 和 System 组成的，并且一个插件中不一定只包含一个 Component。</p><p>所以，开发插件需要实现暴露给用户使用的 Component 和 System。</p><h3 id="插件运行逻辑">插件运行逻辑</h3><p>组件（Component）可以赋予游戏对象能力，我们将一些配置和属性记录在组件上。
系统（System）用来读取组件上面的数据，实现组件对应的能力。</p><p>当系统被添加到游戏实例上后，系统在它所需关心的组件在添加、移除、属性变化时，做一系列对应的操作，即可实现一些功能。</p><p>例如在 Img 插件中，当 Img 被添加到游戏对象上时，System 内会创建一个 Pixi 的 Sprite 对象，挂载到 GameObject 对应的 Pixi Container上，当 Img 组件的 resource 发生变化时，System 会去修改对应 Sprite 上面的 texture。</p><p>接下来，我会讲解如何设计一个组件，以及 System 是如何监听组件变化的。</p><h3 id="构建与发布规范">构建与发布规范</h3><h2 id="开发实践">开发实践</h2><p>下面以 <a href="a11yPlugin">@eva/plugin-a11y</a> 插件为例，对 Eva.js 插件开发做一个详细的介绍。</p><blockquote><p>@eva/plugin-a11y 用于为游戏对象添加无障碍的能力。在 DOM 开发中，无障碍阅读器是可以阅读到 HTML 元素内容的，目前在 Canvas 里的绘制元素无法实现无障碍化的能力，@eva/plugin-a11y 插件通过定位游戏对象的位置，自动化地添加辅助 DOM，使得游戏对象能被无障碍阅读器聚焦，让游戏拥有无障碍功能。</p></blockquote><p>首先设计 Component，既需要赋予游戏对象的能力。</p><h3 id="使用案例">使用案例</h3><pre><code class="language-js">import { A11y, A11ySystem } from &#x27;@eva/plugin-a11y&#x27;

const game = new Game({
  systems: [new A11ySystem()]
})

const go = new GameObject()

go.addComponent(new A11y({
  hint: &#x27;所需朗读的内容&#x27;
}))

game.scene.addChild(go)

</code></pre><h3 id="component-设计">Component 设计</h3><ul><li>确定组件名称: <code>A11y</code> </li><li>设计组件参数:<ul><li>hint 需要朗读的内容</li></ul></li></ul><pre><code class="language-js">import { Component } from &#x27;@eva/eva.js&#x27;
export default class A11y extends Component {
  static componentName: string = &#x27;A11y&#x27; // 这里是Component的名称，用于 System 监听变化

  /**
   * 无障碍标签朗读内容
   */
  public hint: string

  /**
   * 初始化方法，构造函数的参数会传递到这里
   */
  init(param = {hint: &#x27;&#x27;}) {
    const { hint } = param
    this.hint = hint
  }
}
</code></pre><h3 id="system-设计">System 设计</h3><ul><li>确定要监听的组件，以及需要监听哪些参数的变化</li><li>确定系统名字</li><li>根据组件变化实现逻辑</li></ul><h4 id="step1-确定要监听的组件以及参数">Step1 确定要监听的组件以及参数</h4><pre><code class="language-js">import { System, decorators } from &#x27;@eva/eva.js&#x27;

@decorators.componentObserver({
  A11y: [&#x27;hint&#x27;] // 监听 A11y 组件的 hint 属性变化
})
class A11ySystem extends System {

}
</code></pre><p>在上面的代码中，我们将需要监听变化的组件名称和监听属性传入 <code>@decorators.componentObserver</code> 中，以便创建监听。</p><p>如果只需要监听组件添加移除可以不填写具体的属性，例如</p><pre><code class="language-js">@decorators.componentObserver({
  A11y: [] // 监听 A11y 组件的 hint 属性变化
})
</code></pre><p>如果监听的属性不是直接挂载到组件对象上的，还有一级嵌套</p><p>例如监听组件 A 的 style 属性下的 size 属性</p><p>可以这样写：</p><pre><code class="language-js">@decorators.componentObserver({
  A: [{
    prop: [&#x27;style&#x27;, &#x27;size&#x27;]
  }]
})
</code></pre><p>如果想要深度监听 style 属性，可以这样写</p><pre><code class="language-js">@decorators.componentObserver({
  A: [{
    prop: [&#x27;style&#x27;],
    deep: true
  }]
})
</code></pre><p>如果想监听多个组件变化，可以这样写</p><pre><code class="language-js">@decorators.componentObserver({
  A: [{
    prop: [&#x27;style&#x27;],
    deep: true
  }]
  B: [&#x27;props&#x27;]
})
</code></pre><h4 id="step2-设置系统名字">Step2 设置系统名字</h4><p>给 System 设置名字</p><pre><code class="language-js">import { System, decorators } from &#x27;@eva/eva.js&#x27;

@decorators.componentObserver({
  A11y: [&#x27;hint&#x27;] // 监听 A11y 组件的 hint 属性变化
})
class A11ySystem extends System {
  static systemName = &#x27;A11ySystem&#x27;;
}
</code></pre><h4 id="step3-根据组件变化实现逻辑">Step3 根据组件变化实现逻辑</h4><p>在此之前，我们做了一些监听配置，那么我们如何拿到对应的变化呢？</p><p>我们知道 System 有 <code>update</code> 生命周期，我们在生命周期中可以获取到当前帧 Component 的变化。</p><pre><code class="language-js">import { System, decorators, ComponentChanged } from &#x27;@eva/eva.js&#x27;

@decorators.componentObserver({
  A11y: [&#x27;hint&#x27;] // 监听 A11y 组件的 hint 属性变化
})
class A11ySystem extends System {
  static systemName = &#x27;A11ySystem&#x27;;
  private elemMap = new Map()
  update () {
    const changes: ComponentChanged[] = this.componentObserver.clear() // 获取当前帧所有需要监听的组件大变化，并且进行清理
    for (const changed of changes) {
        switch (changed.type) {
          case OBSERVER_TYPE.ADD:
            this.add(changed);
            break;
          case OBSERVER_TYPE.CHANGE:
            this.change(changed)
            break;
          case OBSERVER_TYPE.REMOVE:
            this.remove(changed);
            break;
        }
      }
  }
  add(changed) {
    if (changed.componentName === &#x27;A11y&#x27;) { // 如果有多个Component的话需要分开处理
      const component = changed.component as A11y
      const elem = document.createElement(&#x27;div&#x27;)
      elem.setAttribute(&#x27;aria-label&#x27;, component.hint);
      this.elemMap.set(component, elem)
      document.body.append(elem) // 添加到body上
    }
  }
  remove(changed) {
    if (changed.componentName === &#x27;A11y&#x27;) { // 如果有多个Component的话需要分开处理
      const component = changed.component as A11y
      const elem = this.elemMap.get(component)
      elem.remove() // 移除elem
    }
  }
  change(changed) {
    if (changed.componentName === &#x27;A11y&#x27;) { // 如果有多个Component的话需要分开处理
      if (changed.prop?.prop[0] === &#x27;hint&#x27;){ //如果有多个监听属性需要分开处理
        const component = changed.component as A11y
        elem.setAttribute(&#x27;aria-label&#x27;, component.hint);
      }
    }
  }
}
</code></pre><p>ComponentChanged 对应的类型是这样的，可以参考，不需要在代码里实现</p><pre><code class="language-js">export interface PureObserverProp {
  deep: boolean;
  prop: string[];
}

export enum ObserverType {
  ADD = &#x27;ADD&#x27;,
  REMOVE = &#x27;REMOVE&#x27;,
  CHANGE = &#x27;CHANGE&#x27;,
}

export interface ComponentChanged {
  type: ObserverType;
  component: Component;
  componentName: string;
  prop?: PureObserverProp;
  gameObject?: GameObject;
  systemName?: string;
}

</code></pre><p>现在我们把DOM创建好，并且放到了 body 上面，按照能力来讲，我们已经完成了具体的功能，因为屏幕阅读器已经可以阅读游戏中的元素了，但是看起来目前欠缺一些内容，例如：无法通过触发 DOM 点击事件来触发游戏里面的点击，DOM 的没有宽高和定位。</p><p>如果想实现这些功能，就要去在当前组件下拿到别的组件去实现功能了，如果想触发点击事件，需要判断 <a href="interactionEvent">Event 组件</a>是否安装，如果安装的话，可以根据 Event 上绑定的事件，触发对应的事件。如果想获取宽高位置的话，可以获取游戏对象的 <a href="transformComponent">Transform 组件</a></p><p>增加 Event 组件的监听，在上述 add remove 等方法里做对应操作即可。</p><pre><code class="language-js">@decorators.componentObserver({
  A11y: [&#x27;hint&#x27;] // 监听 A11y 组件的 hint 属性变化
  Event: [] // Event 增加删除监听
})
class A11ySystem extends System {
}
</code></pre><p>对于位置和宽高，可以在 A11y 组件被添加时拿到对应 GameObject 的 Transform，这里仅举个例子</p><pre><code class="language-js">add(changed) {
   if (changed.componentName === &#x27;A11y&#x27;) { // 如果有多个Component的话需要分开处理
      const component = changed.component as A11y
      const elem = document.createElement(&#x27;div&#x27;)
      elem.setAttribute(&#x27;aria-label&#x27;, component.hint);
      this.elemMap.set(component, elem)
      document.body.append(elem) // 添加到body上


      const transform = changed.gameObject.transform
      elem.style.width = transform.size.width + &#x27;px&#x27;
      elem.style.height = transform.size.width + &#x27;px&#x27;
      elem.style.x = transform.position.x + &#x27;px&#x27;
      elem.style.y = transform.position.y + &#x27;px&#x27;
    }
}
</code></pre><h2 id="基于-pixijs-的插件">基于 PixiJS 的插件</h2><p>以图片组件举例：</p><pre><code class="language-js">  import {
    GameObject,
    decorators,
    resource,
    ComponentChanged,
    RESOURCE_TYPE,
    OBSERVER_TYPE,
  } from &#x27;@eva/eva.js&#x27;;
  import {
    RendererManager,
    ContainerManager,
    RendererSystem,
    Renderer,
  } from &#x27;@eva/plugin-renderer&#x27;;

  @decorators.componentObserver({
    Img: [{prop: [&#x27;resource&#x27;], deep: false}],
  })
  export default class Img extends Renderer { // 基于 PixiJS 渲染的插件，我们的 System 需要继承于统一的一个 Renderer 类
  rendererSystem: RendererSystem;
  init() { // 在init中去获取 rendererSystem 以便后续添加 Pixi 对象，并且需要将当前系统注册到rendererManager中。
    this.rendererSystem = this.game.getSystem(RendererSystem) as RendererSystem;
    this.rendererSystem.rendererManager.register(this);
  }
  rendererUpdate(gameObject: GameObject) { // rendererUpdate 代替 Update 方法，因为update在 Renderer 类中已经实现
    const {width, height} = gameObject.transform.size;
    if (this.imgs[gameObject.id]) {
      this.imgs[gameObject.id].sprite.width = width;
      this.imgs[gameObject.id].sprite.height = height;
    }
  }

  async componentChanged(changed: ComponentChanged) { // 在 Renderer 类中实现了 update 方法，并且将 Img 对应的组件变化传递给 componentChanged
  if (changed.componentName === &#x27;Img&#x27;) {
      const component: ImgComponent = changed.component as ImgComponent;
      if (changed.type === OBSERVER_TYPE.ADD) {
        const sprite = new Sprite(null);
        resource.getResource(component.resource).then(({instance}) =&gt; {
          if (!instance) {
            console.error(
              `GameObject:${changed.gameObject.name}&#x27;s Img resource load error`,
            );
          }
          sprite.image = instance;
        });
        this.imgs[changed.gameObject.id] = sprite;
        this.containerManager
          .getContainer(changed.gameObject.id)
          .addChildAt(sprite.sprite, 0); // 将创建的 Pixi 渲染对象放进 GameObject 对应的 Pixi 容器中
      } else if (changed.type === OBSERVER_TYPE.CHANGE) {
        const {instance} = await resource.getResource(component.resource);
        if (!instance) {
          console.error(
            `GameObject:${changed.gameObject.name}&#x27;s Img resource load error`,
          );
        }
        this.imgs[changed.gameObject.id].image = instance;
      } else if (changed.type === OBSERVER_TYPE.REMOVE) {
        const sprite = this.imgs[changed.gameObject.id];
        this.containerManager
          .getContainer(changed.gameObject.id)
          .removeChild(sprite.sprite);
        delete this.imgs[changed.gameObject.id];
      }
    }
  }

</code></pre><h2 id="生命周期">生命周期</h2><p><img src="https://img.alicdn.com/imgextra/i2/O1CN01gEgYOz1T8qevGDloU_!!6000000002338-2-tps-1448-906.png" alt="image.png"></p><h2 id="总结">总结</h2><p>通过 Component 和 System 的结合，我们可以实现各种各样的通用插件，在日常开发中，我们仅需要 <a href="customComponent">CustomComponent</a> 提供的能力开发游戏逻辑即可。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/eva-engine/eva-engine.github.io/tree/master/docs/tutorials/pluginDevelop.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑当前文档</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh-cn/docs/tutorials/performancePlugin"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">« <!-- -->性能监控</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基础" class="table-of-contents__link toc-highlight">基础</a><ul><li><a href="#开发" class="table-of-contents__link toc-highlight">开发</a></li><li><a href="#插件运行逻辑" class="table-of-contents__link toc-highlight">插件运行逻辑</a></li><li><a href="#构建与发布规范" class="table-of-contents__link toc-highlight">构建与发布规范</a></li></ul></li><li><a href="#开发实践" class="table-of-contents__link toc-highlight">开发实践</a><ul><li><a href="#使用案例" class="table-of-contents__link toc-highlight">使用案例</a></li><li><a href="#component-设计" class="table-of-contents__link toc-highlight">Component 设计</a></li><li><a href="#system-设计" class="table-of-contents__link toc-highlight">System 设计</a></li></ul></li><li><a href="#基于-pixijs-的插件" class="table-of-contents__link toc-highlight">基于 PixiJS 的插件</a></li><li><a href="#生命周期" class="table-of-contents__link toc-highlight">生命周期</a></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Eva.js 2019 - NOW &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MIT License</div></div></div></footer></div>
<script src="/zh-cn/assets/js/runtime~main.ae83285c.js"></script>
<script src="/zh-cn/assets/js/main.2e9ad81b.js"></script>
</body>
</html>