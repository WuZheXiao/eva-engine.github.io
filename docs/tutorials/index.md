## 背景

HTML5普及前，想要在Web上面实现炫酷的动画游戏需要借助Flash以及ActionScript，并且移动端对Flash支持度极差，HTML5提供了Canvas的能力，能够让前端在移动端上实现炫酷的渲染效果。市场上开始涌现出一些H5游戏，例如围住神经猫，飞机大战等等。

![飞机大战、围住神经猫](https://img.alicdn.com/imgextra/i4/O1CN01qg0QEk25IQKgKkkKx_!!6000000007503-2-tps-460-396.png)

每个产品不管在什么阶段，都要做用户增长，不断的去拉新，做留存，从而提升的用户活跃度来达到更多的转化。很多行业产品本身的访问频次并不高，但是游戏产品的访问频次很高，将业务与游戏相结合，进行“游戏化”，实现产品的运营目的。所以，市场上出现了很多游戏化产品。比如淘宝、支付宝、京东、饿了么、招商银行等等APP都会有类似的游戏化互动项目。

![令人上瘾的游戏八大驱动力](https://img.alicdn.com/imgextra/i3/O1CN01ewaVp11MCmkKmFrga_!!6000000001399-2-tps-358-347.png)


未来，游戏化互动将会是前端的一个重要方向，深入了解学习这项技术要了解很多游戏领域的相关知识，作为前端开发人员，接触和学习这些知识成本很高，不仅要理解游戏开发的思维又要去学习另外一套游戏的开发知识。

![image.png](https://img.alicdn.com/imgextra/i1/O1CN01FSHH681Ine9wGA0J6_!!6000000000938-2-tps-586-252.png)


对于前端而言，互动方向刚刚起步，业界缺乏很多通用的经验、开发链路、开发工具。一个产品想进行游戏化，需要开发者找到适合互动开发的技术方案，并且整合业界现有的Web游戏或者Web渲染相关的框架和库，找到最适合游戏化互动项目开发的解决方案，其实这是一个可以沉淀的过程，如果业界有现成的方案，其实是可以直接使用的。另外，在互动开发中，有很多性能/用户体验/开发体验问题，例如老系统兼容性问题，内存爆满导致 APP 崩溃问题，开发过程中调试困难的问题等等。

![image.png](https://img.alicdn.com/imgextra/i1/O1CN01FxzQF427HATYbBTDy_!!6000000007771-2-tps-586-110.png)

在淘系互动团队近5年的探索中，我们慢慢的探索和沉淀了一套完整的解决方案，涉及资源生产/开发/测试/发布的整个工作流程，支撑这整个体系的前端内核框架就是今天我们的主角 EVA JS。

## 专注于互动项目开发

EVA JS 的诞生就是为了解决前端领域下的游戏化互动项目的开发，并非为了去开发一个3A级游戏。目前 EVA JS 支持了30多个互动项目的开发，项目边开发边进行互动能力沉淀，沉淀下来了互动领域更常使用的一些能力，例如：Lottie动画播放/无障碍化。


## 还是做前端的事情

游戏化互动作为前端的一个方向，不会脱离前端体系，虽然，为了增加扩展性和游戏逻辑开发便利性，EVA JS 使用了一个游戏常用的设计模式 ECS 模式，并且提供了一套基于 ECS 开发思维的 API。但是 EVA JS 提供了一个完全可以使用前端已有知识开发的方案：RaxEVA，通过 RaxEVA 我们可以使用 Rax+Hooks 的方式进行游戏化互动的开发。Rax是淘系技术部开源的一套语法类似React的框架，也就是说，如果你会 React，你就能够顺畅的开发EVA项目。

```typescript
function App() {
  const resource = useSpriteAnimationResource({
    image: 'https://gw.alicdn.com/tfs/TB1n3LyFhn1gK0jSZKPXXXvUXXa-168-85.png',
    json: 'https://pages.tmall.com/wow/eva/e6250b5ddf5bad9cf5dbbeed7bb95896.json',
  });

  return (
    <Eva width={window.innerWidth} height={window.innerHeight}>
      <scene>
        <SpriteAnimation
          resource={resource}
          speed={100}
          width={84}
          height={85}
        />
      </scene>
    </Eva>
  );
}
```

前端一般都是通过数据驱动视图的，如果你使用了RaxEVA，你可以使用Redux/MobX进行数据管理，如果你没有使用RaxEVA，使用纯 EVA JS 进行游戏化互动开发，EVA JS 也提供了一套数据管理方案：EVAX，EVAX可以让游戏中一份数据变动多处响应，并且提供了全局的事件管理机制，解决基于 ECS 设计模式下的多组件数据管理问题。

## 开放与扩展性

EVA JS 是拥抱开源的，在自己没有更好的方案的时候，会去使用业界成熟的方案，例如渲染引擎，目前我们使用了业界著名的 pixi.js，能够先保障我们的渲染性能达到一定的标准，另外也可以有更多的方案可以快速接入。在开发的过程中，我们可以直接引用 pixi.js 的功能进行开发，但是我们更希望的是能够把它沉淀成 EVAJS 的插件。

EVA JS 的核心是非常轻量级的运行时，所有的能力，包括图片绘制的能力都是以插件（NPM包）的形式提供出来的，我们很容易进行能力的扩展，在各个业务开发的过程中，有业务有通用功能 EVA JS 的插件列表中没有提供的话，通常我们会将其直接沉淀成一个插件，一方面是因为实现插件的成本不高，另外一个方面是沉淀后可以丰富 EVA JS 的生态圈，防止大家重复劳动。例如金币小镇项目沉淀了2.5D等轴侧插件，招财猫项目沉淀了分级体验组件。

我们希望能够有更多的互动开发者使用 EVA JS 进行互动开发，并且在开发的过程中沉淀通用的互动开发能力，建设 EVA JS 互动生态圈，让更多的前端开发者能够开发更丰富的游戏化互动。

## 解决方案

### 预加载方案
为了运行过程中更加流畅，EVA JS 的资源处理对相应的资源进行了预处理，例如骨骼动画资源，将会在加载的时候就将骨骼动画的数据进行预处理，生成好对应的实例，减少在资源使用的时候进行实时处理，提升运行时的效率。通过这种方式，资源可以边加载边实例化，例如：当某个动画当资源加载完成后立即实例化，同时也不会影响其它动画资源加载。

### 无障碍访问
EVA 插件列表提供了无障碍插件，我们可以通过添加无障碍组件进行无障碍化，让视障人士也能体验互动，让这个世界更温暖。当然无障碍应用设计并非一个全自动化的过程，而是需要投入产品设计、开发人力的，我们需要针对具体场景进行无障碍设计，在开发中我们需要针对产品的无障碍设计去写无障碍化所需的代码。

[![normal video.mp4 (13.58MB)](https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ)]()

### 脚本组件

对于前端开发者理解 ECS 架构稍微有一些成本，脚本组件提供了一套生命周期可以进行业务逻辑开发，使用这是方案能够降低理解成本，并且能够提升业务插件的复用性以及扩展性。例如，我们实现农场中某一块田的自生产逻辑，实现自生产组件去阶段性的修改文字组件的内容，引擎自带的渲染系统会读取图片和文字组件中的信息将某块田渲染到画布上。

![image.png](https://img.alicdn.com/imgextra/i3/O1CN01SvNuG21CD6s0upTOu_!!6000000000046-2-tps-666-205.png)

### 数据状态机 EVAX

通过EVAX我们可以维护一份共有数据，多个不同的对象可能会使用同一份数据进行逻辑运行，比如游戏中的生命值，不仅在人的头顶上会显示，游戏中的人物也会根据生命值的多少来展示不同的形态，我们将EVAX组件绑定到游戏对象上，可对某个数据进行监听，如果数据发生变化，可以操作当前游戏对象上其他组件上的数据或者事件。

![image.png](https://img.alicdn.com/imgextra/i3/O1CN017Z3HxX1eizgOCAvTh_!!6000000003906-2-tps-556-270.png)

## 现状

EVA JS 从2019年9月最小可用版本发布至今，已经支持30多个项目，涉及淘宝/天猫/支付宝/AE/Lazada/优酷/淘宝特价板等客户端，支持的互动项目已超过5亿用户游玩，每日超过6千万用户，无引发故障。

![image.png](https://img.alicdn.com/imgextra/i3/O1CN013BFZBh1MYJMTBjEjP_!!6000000001446-2-tps-645-270.png)
目前提供了常用的互动能力可供实现常用的互动能力。


## 展望

未来我们希望继续在前端互动领域耕耘，为前端开发者提供更好的互动开发体验。希望能够将阿里巴巴内部的更多技术方案带到整个业界，让技术方案流动起来，让更多企业和个人能够使用现成的技术方案进行游戏化互动的开发。建设更完整的社区环境，不仅仅是阿里巴巴内部的互动开发者，让更多的业界其他公司和开发者参与到 EVA JS 互动生态的建设中来，让 EVAJS 不仅仅能是电商/文娱/金融行业的互动场景，也能支持更多行业的互动场景。

对于阿里巴巴内部而言，我们可以使用开始提到的整套互动解决方案进行互动游戏的开发，但是对于阿里巴巴外部而言，我们目前正在逐步开放开源 EVA JS，我们希望，在未来的某个时间，我们能够慢慢将整套体系开放给业界使用。希望未来 EVA JS 能够引领互动技术的发展，更多的技术是由 EVA JS 互动开发者们实现和定义出来的，

实现我们的目标——“人人可开发，处处有互动”。

## 团队

团队介绍：[https://www.yuque.com/eva/blog/intro](https://www.yuque.com/eva/blog/intro)

对于 EVA JS 有疑问或者建议的可以加钉钉群。

## 扩展阅读

[玩转娱乐化时代|淘系互动团队几年的技术沉淀+经验都在这！](https://mp.weixin.qq.com/s/DTPW0qAbB_2913zRORnaPg)

[如何实现高性能可扩展的互动游戏框架](https://www.yuque.com/eva/blog/mgh2bq)

[史上最快破5亿用户的互动 - 2020双11养猫技术大揭秘](https://mp.weixin.qq.com/s/_oTt-RG48hRmX2X15MuX8w)

[手把手教你开发互动游戏，看 EVA 互动技术体系在金币小镇的实践](https://mp.weixin.qq.com/s/STFGj_3_Z1gpacOWo2L5Hw)

[淘宝设计游戏化专题](https://www.yuque.com/eva/blog/rli8xo)

[游戏化设计理论在互联网产品中的运用](https://mp.weixin.qq.com/s/iT211o4QrTSy2gcZi9Umnw)
